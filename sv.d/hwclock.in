#!/bin/bash

. @RCLIBDIR@/functions

HWCLOCK_PARAMS="--systz"
HARDWARECLOCK=${HARDWARECLOCK:-UTC}

case $HARDWARECLOCK in
    UTC) HWCLOCK_PARAMS+=" --utc --noadjfile" ;;
    localtime) HWCLOCK_PARAMS+=" --localtime --noadjfile" ;;
    *) HWCLOCK_PARAMS="";;
esac

case "$1" in
    start)
        stat_busy "Adjusting hwclock to ${HARDWARECLOCK}"
        hwclock $HWCLOCK_PARAMS || stat_die
        add_daemon hwclock
        stat_done
        ;;
    stop)
        stat_busy "Adjusting hwclock to ${HARDWARECLOCK}"
        hwclock --adjust $HWCLOCK_PARAMS || stat_die
        rm_daemon hwclock
        stat_done
        ;;
    restart)
        $0 stop
        sleep 2
        $0 start
        ;;
    *)
        echo "usage: $0 {start|stop|restart}"
        ;;
esac

