#!/bin/bash

# sourcing our current rc.conf requires this to be a bash script
. @RCLIBDIR@/functions

case "$1" in
    start)
        if ! pgrep -f "runsv udevd" >/dev/null; then
            stat_busy "Starting udev and waiting for devices to settle"
            udevd --daemon
            udevadm trigger --action=add --type=subsystems
            udevadm trigger --action=add --type=devices
            udevadm settle
            stat_done
        fi
        add_daemon udev
    ;;
    stop)
        stat_busy "Stopping udev"
        udevadm control --exit || stat_die udev
        rm_daemon udev
        stat_done udev
    ;;
    *)
        echo "usage: $0 {start|stop}"
        exit 1
    ;;
esac
