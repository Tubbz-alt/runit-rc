#!/bin/sh
msg "Initializing random seed"
cp /var/lib/random-seed /dev/urandom >/dev/null 2>&1 || true
( umask 077; bytes=$(cat /proc/sys/kernel/random/poolsize) || bytes=512; dd if=/dev/urandom of=/var/lib/random-seed count=1 bs=$bytes >/dev/null 2>&1 )

msg "Setting up loopback interface"
ip link set up dev lo

[ -r /etc/hostname ] && [ -s /etc/hostname ] && read -r HOSTNAME < /etc/hostname
if [ -n "$HOSTNAME" ]; then
	msg "Setting hostname to ${HOSTNAME}"
	printf "%s" "$HOSTNAME" >| /proc/sys/kernel/hostname
else
	msg_warn "/etc/hostname is empty, hostname set to artixlinux"
fi

if [ -x /usr/bin/tmpfiles ]; then
	msg "Setting up tmpfiles"
	tmpfiles --exclude-prefix=/dev --create --remove --boot
fi

if [ -x /usr/bin/sysusers ]; then
	msg "Setting up sysusers"
	sysusers
fi
